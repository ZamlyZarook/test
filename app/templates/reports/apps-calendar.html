{% extends "partials/base.html" %}

{% block title %}ETA Calendar{% endblock title %}

{% block extra_css %}
<!-- Add any extra CSS needed for the calendar -->
<link href="{{url_for('static' ,filename='libs/fullcalendar/main.min.css')}}" rel="stylesheet" type="text/css" />

<style>
    /* Ensure the main content area takes full height */
    .main-content {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
    }
    
    /* Make page content grow to take available space */
    .page-content {
        flex: 1;
        display: flex;
        flex-direction: column;
    }
    
    /* Calendar container styling */
    .calendar-container {
        flex: 1 1 auto;
        display: flex;
        flex-direction: column;
    }
    
    /* Ensure the card takes full height */
    .calendar-card {
        flex: 1 1 auto;
        display: flex;
        flex-direction: column;
        margin-bottom: 1.5rem;
    }
    
    /* Make calendar body take remaining space */
    .calendar-card .card-body {
        flex: 1 1 auto;
        padding: 1.25rem;
        overflow: hidden;
    }
    
    /* Calendar styling */
    #calendar {
        width: 100%;
        height: 100%;
    }
    
    /* Make events more visible */
    .fc-event {
        cursor: pointer;
        margin: 2px 0;
    }
    
    .fc-daygrid-day-number {
        font-weight: 500;
    }
    
    /* Style for ETA events */
    .eta-event {
        font-weight: 500;
        padding: 3px 6px;
        border-radius: 4px;
        margin-bottom: 2px;
        cursor: pointer;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        font-size: 0.85rem;
        box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    
    /* Make the calendar buttons look better */
    .fc-button-group {
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .fc-toolbar-chunk {
        display: flex;
        align-items: center;
    }
    
    /* Debug styles - hidden by default */
    .debug-info {
        padding: 10px;
        background-color: #f8f9fa;
        border: 1px solid #ddd;
        margin-bottom: 15px;
        display: none;
    }
    
    /* Custom controls styling */
    .calendar-controls {
        padding: 0.5rem 1.25rem;
        background-color: #f9f9f9;
        border-bottom: 1px solid #e9e9ef;
    }
    
    .custom-btn-group .btn {
        padding: 0.35rem 0.75rem;
        font-size: 0.8125rem;
    }
    
    /* Responsive adjustments */
    @media (max-width: 767.98px) {
        .calendar-controls {
            padding: 0.5rem;
        }
        
        .fc-toolbar {
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .fc-toolbar-chunk {
            justify-content: center;
            width: 100%;
        }
    }
    
    /* Add loading state for the calendar */
    .calendar-loading {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(255, 255, 255, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 999;
    }

    /* Add this to your CSS section */
.fc-event {
    border: none !important;
    background-color: #f8f9fa !important;
}

.fc-event-main {
    background-color: #f8f9fa !important;
}

/* List view time styling - black color */
.fc-list-event-time {
    color: #000000 !important;
}
</style>
{% endblock extra_css %}

{% block content %}
<!-- Start right Content here -->
<div class="main-content">
    <div class="page-content">
        <div class="container-fluid">
            <!-- start page title -->
            <div class="row">
                <div class="col-12">
                    <div class="page-title-box d-sm-flex align-items-center justify-content-between bg-galaxy-transparent">
                        <h4 class="mb-sm-0">ETA Calendar</h4>

                        <div class="page-title-right">
                            <ol class="breadcrumb m-0">
                                <li class="breadcrumb-item"><a href="javascript: void(0);">Reports</a></li>
                                <li class="breadcrumb-item active">ETA Calendar</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
            <!-- end page title -->

            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert" id="flash-message">
                <i class="ri-check-double-line"></i>
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
            {% endif %}
            {% endwith %}

            <!-- Main calendar container -->
            <div class="row h-100">
                <div class="col-12">
                    <div class="calendar-container">
                        <div class="card calendar-card">
                            <div class="card-header py-2">
                                <div class="d-flex align-items-center">
                                    <h5 class="card-title mb-0 flex-grow-1">Shipment ETA Calendar</h5>

                                    <!-- Customer Filter Dropdown -->
                                    <div class="flex-shrink-0 me-3">
                                        <select class="form-select form-select" id="customer-filter" style="min-width: 180px;">
                                            <option value="">All Customers</option>
                                            <!-- Options will be populated dynamically -->
                                        </select>
                                    </div>

                                    <div class="flex-shrink-0">
                                        <div class="d-flex gap-2">
                                            <div class="btn-group custom-btn-group">
                                                <button class="btn btn-soft-primary btn-sm" id="btn-month">Month View</button>
                                                <button class="btn btn-soft-secondary btn-sm" id="btn-list">List View</button>
                                            </div>
                                            <button class="btn btn-soft-info btn-sm" id="btn-refresh">
                                                <i class="ri-refresh-line align-bottom"></i> Refresh
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="calendar-controls">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="d-flex align-items-center">
                                            <span class="badge bg-primary-subtle text-primary me-2 px-2 py-1">
                                                <i class="ri-ship-line me-1"></i> Total Shipments: <span id="shipment-count">0</span>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="col-md-8">
                                        <div class="d-flex align-items-center justify-content-md-end">
                                            <!-- <span class="text-muted small me-3">Legend:</span>
                                            <div class="d-flex gap-2">
                                                <span class="badge bg-primary-subtle text-primary me-1">Import</span>
                                                <span class="badge bg-success-subtle text-success me-1">Export</span>
                                                <span class="badge bg-warning-subtle text-warning me-1">Pending</span>
                                                <span class="badge bg-danger-subtle text-danger me-1">Urgent</span>
                                            </div> -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body p-0">
                                <div class="position-relative h-100">
                                    <!-- Loading indicator -->
                                    <div class="calendar-loading" id="calendar-loader">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                    </div>
                                    <!-- Calendar container -->
                                    <div id="calendar" class="h-100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Shipment Details MODAL -->
            <div class="modal fade" id="shipment-modal" tabindex="-1">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content border-0">
                        <div class="modal-header p-3 bg-info-subtle">
                            <h5 class="modal-title" id="modal-title">Shipment Details</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-hidden="true"></button>
                        </div>
                        <div class="modal-body p-4">
                            <div class="shipment-details">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center">
                                            <div class="flex-shrink-0 me-3">
                                                <i class="ri-profile-line text-primary fs-24"></i>
                                            </div>
                                            <div class="flex-grow-1">
                                                <h5 class="mb-1">Job No</h5>
                                                <p class="text-muted mb-0" id="import-id"></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center">
                                            <div class="flex-shrink-0 me-3">
                                                <i class="ri-calendar-event-line text-success fs-24"></i>
                                            </div>
                                            <div class="flex-grow-1">
                                                <h5 class="mb-1">ETA</h5>
                                                <p class="text-muted mb-0" id="eta-date"></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center">
                                            <div class="flex-shrink-0 me-3">
                                                <i class="ri-profile-line text-secondary fs-24"></i>
                                            </div>
                                            <div class="flex-grow-1">
                                                <h5 class="mb-1">PO No</h5>
                                                <p class="text-muted mb-0" id="po-no"></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center">
                                            <div class="flex-shrink-0 me-3">
                                                <i class="ri-file-text-line text-warning fs-24"></i>
                                            </div>
                                            <div class="flex-grow-1">
                                                <h5 class="mb-1">Invoice No</h5>
                                                <p class="text-muted mb-0" id="invoice-no"></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center">
                                            <div class="flex-shrink-0 me-3">
                                                <i class="ri-file-list-3-line text-success fs-24"></i>
                                            </div>
                                            <div class="flex-grow-1">
                                                <h5 class="mb-1">BL Number</h5>
                                                <p class="text-muted mb-0" id="bl-no"></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center">
                                            <div class="flex-shrink-0 me-3">
                                                <i class="ri-ship-line text-info fs-24"></i>
                                            </div>
                                            <div class="flex-grow-1">
                                                <h5 class="mb-1">Vessel</h5>
                                                <p class="text-muted mb-0" id="vessel-name"></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center">
                                            <div class="flex-shrink-0 me-3">
                                                <i class="ri-map-pin-line text-danger fs-24"></i>
                                            </div>
                                            <div class="flex-grow-1">
                                                <h5 class="mb-1">Port of Loading</h5>
                                                <p class="text-muted mb-0" id="port-loading"></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center">
                                            <div class="flex-shrink-0 me-3">
                                                <i class="ri-map-pin-5-line text-primary fs-24"></i>
                                            </div>
                                            <div class="flex-grow-1">
                                                <h5 class="mb-1">Port of Discharge</h5>
                                                <p class="text-muted mb-0" id="port-discharge"></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center">
                                            <div class="flex-shrink-0 me-3">
                                                <i class="ri-user-3-line text-secondary fs-24"></i>
                                            </div>
                                            <div class="flex-grow-1">
                                                <h5 class="mb-1">Customer</h5>
                                                <p class="text-muted mb-0" id="customer-name"></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center">
                                            <div class="flex-shrink-0 me-3">
                                                <i class="ri-user-settings-line text-success fs-24"></i>
                                            </div>
                                            <div class="flex-grow-1">
                                                <h5 class="mb-1">Sales Person</h5>
                                                <p class="text-muted mb-0" id="sales-person"></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-12">
                                        <div class="d-flex align-items-start">
                                            <div class="flex-shrink-0 me-3">
                                                <i class="ri-file-text-line text-info fs-24"></i>
                                            </div>
                                            <div class="flex-grow-1">
                                                <h5 class="mb-1">Cargo Description</h5>
                                                <p class="text-muted mb-0" id="cargo-description"></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-12">
                                        <div class="d-flex align-items-start">
                                            <div class="flex-shrink-0 me-3">
                                                <i class="ri-information-line text-warning fs-24"></i>
                                            </div>
                                            <div class="flex-grow-1">
                                                <h5 class="mb-1">Remarks</h5>
                                                <p class="text-muted mb-0" id="remarks-text"></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-4 text-end">
                                <!-- <a href="#" id="view-details-link" class="btn btn-primary">View Full Details</a> -->
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div> <!-- end modal-content-->
                </div> <!-- end modal dialog-->
            </div> <!-- end modal-->
        </div>
        <!-- container-fluid -->
    </div>
    <!-- End Page-content -->

    {% block footer %}
    {% include "partials/footer.html" %}
    {% endblock footer %}
</div>
{% endblock content %}

{% block extra_js %}
<!-- Required plugins for calendar -->
<script src="{{url_for('static' ,filename='libs/flatpickr/flatpickr.min.js')}}"></script>
<script src="{{url_for('static' ,filename='libs/fullcalendar/main.min.js')}}"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
    console.log("ETA Calendar initialization started");
    
    // Show loading indicator
    const calendarLoader = document.getElementById('calendar-loader');
    
    // Store all shipment data for filtering
    let allShipmentData = [];
    let currentCustomerFilter = '';
    
    // Force CSS to ensure calendar visibility
    const addStyles = () => {
        // Create style element
        const style = document.createElement('style');
        style.innerHTML = `
            /* Ensure calendar table is visible */
            .fc-scrollgrid-sync-table {
                width: 100% !important;
                height: auto !important;
                min-height: 500px !important;
            }
            
            /* Make day cells clearly visible */
            .fc-daygrid-day {
                min-height: 80px !important;
                border: 1px solid #ddd !important;
                background-color: #ffffff !important;
            }
            
            /* Fix header visibility */
            .fc-col-header {
                width: 100% !important;
                visibility: visible !important;
            }
            
            /* Fix viewport issues */
            .fc-view-harness {
                height: auto !important;
                min-height: 500px !important;
            }
            
            /* Make sure the grid takes up space */
            .fc-daygrid-body {
                width: 100% !important;
                height: auto !important;
                min-height: 450px !important;
            }
            
            /* Force table layout */
            .fc-scrollgrid {
                table-layout: fixed !important;
                width: 100% !important;
                border-collapse: collapse !important;
            }
            
            /* Ensure day numbers are visible */
            .fc-daygrid-day-number {
                color: #000 !important;
                font-weight: bold !important;
                padding: 8px !important;
            }
        `;
        document.head.appendChild(style);
    };
    
    // Add the styles immediately
    addStyles();
    
    try {
        // Initialize calendar with explicit dimensions
        var calendarEl = document.getElementById('calendar');
        
        if (!calendarEl) {
            console.error("Error: Calendar element not found!");
            return;
        }
        
        // Force the parent container to have enough height
        const cardBody = calendarEl.closest('.card-body');
        if (cardBody) {
            cardBody.style.minHeight = '600px';
            cardBody.style.height = 'auto';
            cardBody.style.overflow = 'visible';
        }
        
        // Make sure the calendar element itself has dimensions
        calendarEl.style.minHeight = '550px';
        calendarEl.style.height = 'auto';
        calendarEl.style.width = '100%';
        calendarEl.style.display = 'block';
        
        // Check if FullCalendar is loaded
        if (typeof FullCalendar === 'undefined') {
            console.error("Error: FullCalendar library not loaded!");
            calendarEl.innerHTML = `
                <div class="alert alert-warning">
                    <h5>Calendar Library Not Loaded</h5>
                    <p>Please check that the FullCalendar library is correctly included in your project.</p>
                    <button class="btn btn-sm btn-primary mt-2" onclick="window.location.reload()">Reload Page</button>
                </div>
            `;
            if (calendarLoader) calendarLoader.style.display = 'none';
            return;
        }
        
        // Create calendar with explicit height settings
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,listMonth'
            },
            // Set explicit height instead of 100%
            height: 550,
            contentHeight: 'auto',
            aspectRatio: 1.35,
            selectable: true,
            dayMaxEvents: true,
            expandRows: true, // Important for showing all days properly
            fixedWeekCount: true, // Show 6 weeks always
            showNonCurrentDates: true, // Show days from other months
            events: [], // Start with empty events, no dummy data
            eventClick: function(info) {
                showShipmentDetails(info.event);
            },
            eventContent: function(arg) {
                var eventHtml = '';
                if (arg.event.extendedProps && arg.event.extendedProps.isEta) {
                    eventHtml = `
                        <div class="eta-event bg-${arg.event.extendedProps.colorClass}-subtle text-${arg.event.extendedProps.colorClass}">
                            <i class="ri-ship-line me-1"></i> ${arg.event.title}
                        </div>
                    `;
                    return { html: eventHtml };
                }
                return;
            },
            views: {
                dayGridMonth: {
                    titleFormat: { year: 'numeric', month: 'long' },
                    dayHeaderFormat: { weekday: 'short' }
                },
                listMonth: {
                    listDayFormat: { weekday: 'long', day: 'numeric', month: 'long' },
                    listDaySideFormat: { year: 'numeric' }
                }
            },
            datesSet: function(dateInfo) {
                console.log("Calendar view changed:", dateInfo.view.type);
                
                // Update active button based on current view
                const monthBtn = document.getElementById('btn-month');
                const listBtn = document.getElementById('btn-list');
                
                if (dateInfo.view.type === 'dayGridMonth') {
                    monthBtn.classList.remove('btn-soft-secondary');
                    monthBtn.classList.add('btn-soft-primary');
                    listBtn.classList.remove('btn-soft-primary');
                    listBtn.classList.add('btn-soft-secondary');
                } else {
                    listBtn.classList.remove('btn-soft-secondary');
                    listBtn.classList.add('btn-soft-primary');
                    monthBtn.classList.remove('btn-soft-primary');
                    monthBtn.classList.add('btn-soft-secondary');
                }
                
                // Force resize after view change
                setTimeout(() => {
                    calendar.updateSize();
                }, 100);
            }
        });
        
        // Render the calendar immediately
        calendar.render();
        console.log("Initial calendar rendering complete");
        
        // Force a resize after a short delay to fix rendering issues
        setTimeout(() => {
            calendar.updateSize();
            console.log("Calendar size updated");
        }, 200);
        
        // Handle view buttons
        document.getElementById('btn-month').addEventListener('click', function() {
            calendar.changeView('dayGridMonth');
            // Force resize after view change
            setTimeout(() => {
                calendar.updateSize();
            }, 100);
        });
        
        document.getElementById('btn-list').addEventListener('click', function() {
            calendar.changeView('listMonth');
        });
        
        // Handle refresh button
        document.getElementById('btn-refresh').addEventListener('click', function() {
            // Reset customer filter to "All Customers"
            currentCustomerFilter = '';
            document.getElementById('customer-filter').value = '';
            
            // Show loading indicator
            if (calendarLoader) calendarLoader.style.display = 'flex';
            fetchETAData(calendar);
        });
        
        // Handle customer filter change
        document.getElementById('customer-filter').addEventListener('change', function() {
            currentCustomerFilter = this.value;
            applyCustomerFilter(calendar);
        });
        
        // Make calendar responsive
        window.addEventListener('resize', function() {
            calendar.updateSize();
        });
        
        // Now fetch data and update the calendar
        fetchETAData(calendar);
        
    } catch (error) {
        console.error("Error initializing calendar:", error.message);
        // Hide loading indicator
        if (calendarLoader) calendarLoader.style.display = 'none';
    }
    
    // Function to fetch ETA data from server
    function fetchETAData(calendar) {
        // Show loading indicator
        if (calendarLoader) calendarLoader.style.display = 'flex';
        
        // Make AJAX request to get the data
        fetch('/reports/api/shipments/eta')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                // Store all data for filtering
                allShipmentData = data;
                
                // Populate customer filter dropdown
                populateCustomerFilter(data);
                
                // Apply current filter and update calendar
                applyCustomerFilter(calendar);
                
                console.log("Calendar updated with ETA data");
            })
            .catch(error => {
                console.error('Error fetching ETA data:', error);
                // Just log the error, don't show any message to the user
                if (calendar) {
                    // Set shipment count to 0
                    document.getElementById('shipment-count').textContent = '0';
                }
            })
            .finally(() => {
                // Hide loading indicator when done (success or failure)
                if (calendarLoader) calendarLoader.style.display = 'none';
            });
    }
    
    // Function to populate customer filter dropdown
    function populateCustomerFilter(data) {
        const customerFilter = document.getElementById('customer-filter');
        
        // Get unique customers with short names
        const customers = [];
        const customerMap = new Map();
        
        data.forEach(shipment => {
            if (shipment.customer_id && shipment.customer_short_name) {
                if (!customerMap.has(shipment.customer_id)) {
                    customerMap.set(shipment.customer_id, {
                        id: shipment.customer_id,
                        short_name: shipment.customer_short_name,
                        full_name: shipment.customer_name
                    });
                }
            }
        });
        
        // Convert map to array and sort by short name
        customers.push(...customerMap.values());
        customers.sort((a, b) => a.short_name.localeCompare(b.short_name));
        
        // Clear existing options except "All Customers"
        while (customerFilter.children.length > 1) {
            customerFilter.removeChild(customerFilter.lastChild);
        }
        
        // Add customer options
        customers.forEach(customer => {
            const option = document.createElement('option');
            option.value = customer.id;
            option.textContent = customer.short_name;
            customerFilter.appendChild(option);
        });
    }
    
    // Function to apply customer filter
    function applyCustomerFilter(calendar) {
        // Filter data based on selected customer
        let filteredData = allShipmentData;
        
        if (currentCustomerFilter) {
            filteredData = allShipmentData.filter(shipment => 
                shipment.customer_id == currentCustomerFilter
            );
        }
        
        // Transform filtered data to events
        const events = transformETADataToEvents(filteredData);
        
        // Update shipment count
        document.getElementById('shipment-count').textContent = events.length;
        
        // Remove all existing events
        if (calendar) {
            calendar.getEvents().forEach(function(event) {
                event.remove();
            });
            
            // Add filtered events
            events.forEach(function(event) {
                calendar.addEvent(event);
            });
            
            // Force resize after data update
            setTimeout(() => {
                calendar.updateSize();
            }, 100);
        }
    }
    
    // Transform API data to calendar events
    function transformETADataToEvents(data) {
        return data.map(function(shipment) {
            var colorClass = getShipmentColorClass(shipment);
            
            var title = shipment.import_id || 'Shipment #' + shipment.id;
            if (shipment.customer_short_name) {
                title += ' - ' + shipment.customer_short_name;
            }

            return {
                id: shipment.id,
                title: title,
                start: shipment.eta,
                extendedProps: {
                    isEta: true,
                    import_id: shipment.import_id,
                    customer_short_name: shipment.customer_short_name,
                    bl_no: shipment.bl_no,
                    vessel: shipment.vessel,
                    voyage: shipment.voyage,
                    port_of_loading: shipment.port_of_loading,
                    port_of_discharge: shipment.port_of_discharge,
                    customer_id: shipment.customer_id,
                    customer_name: shipment.customer_name,
                    sales_person_id: shipment.sales_person_id,
                    sales_person_name: shipment.sales_person_name,
                    cargo_description: shipment.cargo_description,
                    remarks: shipment.remarks,
                    colorClass: colorClass,
                    po_no: shipment.po_no,
                    invoice_no: shipment.invoice_no
                },
                className: 'bg-' + colorClass + '-subtle',
                display: 'block'
            };
        });
    }
    
    // Determine color class based on shipment properties
    function getShipmentColorClass(shipment) {
        // You can implement business logic here to determine the color
        // based on shipment type, status, or other properties
        
        // Simple example: cycle through colors based on ID
        var colors = ['primary', 'success', 'warning', 'danger', 'info'];
        return colors[shipment.id % colors.length];
    }
    
    // Function to show shipment details
    function showShipmentDetails(event) {
        if (!event || !event.extendedProps || !event.extendedProps.isEta) return;
        
        // Populate modal with shipment details
        document.getElementById('import-id').textContent = event.extendedProps.import_id || 'N/A';
        document.getElementById('eta-date').textContent = formatDateTime(event.start);
        document.getElementById('bl-no').textContent = event.extendedProps.bl_no || 'N/A';
        document.getElementById('vessel-name').textContent = event.extendedProps.vessel || 'N/A';
        document.getElementById('port-loading').textContent = event.extendedProps.port_of_loading || 'N/A';
        document.getElementById('port-discharge').textContent = event.extendedProps.port_of_discharge || 'N/A';
        document.getElementById('customer-name').textContent = event.extendedProps.customer_name || 'N/A';
        document.getElementById('sales-person').textContent = event.extendedProps.sales_person_name || 'N/A';
        document.getElementById('cargo-description').textContent = event.extendedProps.cargo_description || 'N/A';
        document.getElementById('remarks-text').textContent = event.extendedProps.remarks || 'N/A';
        document.getElementById('po-no').textContent = event.extendedProps.po_no || 'N/A';
        document.getElementById('invoice-no').textContent = event.extendedProps.invoice_no || 'N/A';

       // Set up the view details link
        // document.getElementById('view-details-link').href = `/shipments/view/${event.id}`;
       
       // Show the modal
       var shipmentModal = new bootstrap.Modal(document.getElementById('shipment-modal'));
       shipmentModal.show();
    }
    
    // Helper function to format date and time
    function formatDateTime(date) {
        if (!date) return 'N/A';
        
        var options = { 
            weekday: 'long',
            year: 'numeric', 
            month: 'long', 
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
        };
        
        return new Date(date).toLocaleDateString('en-US', options);
    }
});
</script>
{% endblock extra_js %}