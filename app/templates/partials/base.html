
<!DOCTYPE html>
<html lang="en" data-layout="vertical" data-topbar="light" data-sidebar="dark" data-sidebar-size="lg" data-sidebar-image="none" data-preloader="disable">
<head>
    <meta charset="utf-8" />
    <title>{% block title %}{% endblock title %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description" />
    <meta content="Themesbrand" name="author" />
    <!-- App favicon -->
    <link rel="shortcut icon" href="{{url_for('static' ,filename='images/favicon.png')}}" />

    <!-- Add these meta tags in your base template or page head -->
<meta name="user-id" content="{{ current_user.id }}">
<meta name="user-name" content="{{ current_user.username }}">
    {% block css %}
    {% block extra_css %}
    {% endblock extra_css %}

    <!-- Layout config Js -->
    <script src="{{url_for('static' ,filename='js/layout.js')}}"></script>
    <!-- Bootstrap Css -->
    <link href="{{url_for('static' ,filename='css/bootstrap.min.css')}}" id="bootstrap-style" rel="stylesheet" type="text/css" />
    <!-- Icons Css -->
    <link href="{{url_for('static' ,filename='css/icons.min.css')}}" rel="stylesheet" type="text/css" />
    <!-- App Css-->
    <link href="{{url_for('static' ,filename='css/app.min.css')}}" id="app-style" rel="stylesheet" type="text/css" />
    <!-- custom Css-->
    <link href="{{url_for('static' ,filename='css/custom.min.css')}}" id="app-style" rel="stylesheet" type="text/css" />
    <link href="{{url_for('static' ,filename='css/chat.css')}}" id="app-style" rel="stylesheet" type="text/css" />
    
    {% endblock css %}
</head>

<body>
    <!-- Begin page -->
    <div id="layout-wrapper">
        {% block header %}
        {% include "partials/topbar.html" %}
        {% endblock header %}
        {% block sidebar %}
        {% include "partials/sidebar.html" %}
        {% endblock sidebar %}
        {% block content %}

        {% block footer %}
        {% endblock footer %}
        {% endblock content %}
    </div>
    
    {% block extra_content %}        
    {% endblock extra_content %}
        
    <!-- END layout-wrapper -->
    {% block right_sidebar %}
    {% include "partials/customizer.html" %}
    {% endblock right_sidebar %}

    {% block javascript %}
    <!-- JAVASCRIPT -->
    <script src="{{url_for('static' ,filename='libs/bootstrap/dist/js/bootstrap.bundle.min.js')}}"></script>
    <script src="{{url_for('static' ,filename='libs/simplebar/dist/simplebar.min.js')}}"></script>
    <script src="{{url_for('static' ,filename='libs/node-waves/dist/waves.min.js')}}"></script>
    <script src="{{url_for('static' ,filename='libs/feather-icons/dist/feather.min.js')}}"></script>
    <script src="{{url_for('static' ,filename='js/pages/plugins/lord-icon-2.1.0.js')}}"></script>
    <script src="{{url_for('static' ,filename='js/plugins.js')}}"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


    <script>
        // Add this to your base template or common JS file
        document.addEventListener('DOMContentLoaded', function() {
            // Get the current company ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const companyId = urlParams.get('company_id');
            
            if (companyId) {
                // Add company_id to all links on the page that don't already have it
                document.querySelectorAll('a').forEach(function(link) {
                if (link.href && link.href.startsWith(window.location.origin) && 
                    !link.href.includes('company_id=') &&
                    !link.href.includes('logout') &&
                    !link.classList.contains('dropdown-item') &&  // Skip dropdown items
                    link.href !== '#') {
                    
                    const url = new URL(link.href);
                    // Preserve existing query parameters
                    url.searchParams.append('company_id', companyId);
                    link.href = url.toString();
                }
                });
                
                // Add company_id to all forms on the page
                document.querySelectorAll('form').forEach(function(form) {
                if (form.method === 'get' && !form.querySelector('input[name="company_id"]')) {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = 'company_id';
                    input.value = companyId;
                    form.appendChild(input);
                }
                });
                
                // Add company_id to fetch requests
                const originalFetch = window.fetch;
                window.fetch = function(url, options) {
                // Only modify URLs from our domain and API endpoints
                if (typeof url === 'string' && url.startsWith(window.location.origin)) {
                    const modifiedUrl = new URL(url, window.location.origin);
                    
                    // Add company_id if it's not already there
                    if (!modifiedUrl.searchParams.has('company_id')) {
                    modifiedUrl.searchParams.append('company_id', companyId);
                    url = modifiedUrl.toString();
                    }
                }
                
                return originalFetch(url, options);
                };
            }
            });
    </script>

    {% block extra_js %}
    {% endblock extra_js %}

    <!-- App js -->
    <script src="{{url_for('static' ,filename='js/app.js')}}"></script>
    {% endblock javascript %}

</body>

</html>